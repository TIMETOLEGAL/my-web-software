<!-- This is script.js content only. CSS must be inside index.html or linked externally -->
/* ADD THIS TO style.css */

body {
  font-family: Arial, sans-serif;
  background: #fff;
  color: #111;
}
.screen {
  padding: 40px;
  max-width: 600px;
  margin: 50px auto;
  border-radius: 12px;
  box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
  background-color: #fff;
}
h1, h2, h3 {
  color: #c4001d;
}
input, select, button {
  width: 100%;
  padding: 10px;
  margin: 10px 0;
  font-size: 16px;
}
button {
  background-color: #c4001d;
  color: white;
  border: none;
  cursor: pointer;
  border-radius: 6px;
}
button:hover {
  background-color: #a00017;
}
.hidden {
  display: none;
}
nav button {
  width: auto;
  margin-right: 10px;
}
#task-list {
  padding: 10px;
  border: 1px solid #ccc;
}
.toggle-link {
  color: #c4001d;
  text-align: center;
  display: block;
  cursor: pointer;
  margin-top: 10px;
}

// Existing JavaScript logic continues here...
const API_URL = "https://script.google.com/macros/s/AKfycby46orkSSxefSTu75D0A9CIR7il9TOJrxgz-hEvNJi7ocaima_JAX1CkORvCmwzfJ1J/exec";

let currentUser = null;
let currentRole = null;

function login() {
  const user = document.getElementById("username").value.trim();
  const pass = document.getElementById("password").value.trim();

  fetch(API_URL, {
    method: "POST",
    body: new URLSearchParams({ action: "getUsers" })
  })
    .then(res => res.text())
    .then(text => {
      const rows = JSON.parse(text);
      const index = rows.findIndex(r => r[0] === user && r[1] === pass);
      if (index === -1) {
        document.getElementById("login-error").textContent = "Invalid credentials";
        return;
      }
      const role = rows[index][2];
      const approved = rows[index][3] === "true";

      currentUser = user;
      currentRole = role;

      if (!approved) {
        showScreen("approval-screen");
      } else {
        document.getElementById("role").textContent = role;
        showScreen("dashboard");
        if (role === "Director") renderAdminPanel();
        if (role === "Back") loadTasks();
      }
    });
}

function register() {
  const user = document.getElementById("reg-username").value.trim();
  const pass = document.getElementById("reg-password").value.trim();
  const role = document.getElementById("reg-role").value;

  fetch(API_URL, {
    method: "POST",
    body: new URLSearchParams({
      action: "registerUser",
      username: user,
      password: pass,
      role: role
    })
  })
    .then(res => res.text())
    .then(txt => {
      if (txt === "success") {
        document.getElementById("register-success").textContent = "Registration successful! Awaiting Director approval.";
      } else {
        document.getElementById("register-success").textContent = "Error occurred.";
      }
    });
}

function uploadTask() {
  const category = document.getElementById("task-category").value;
  const client = document.getElementById("client-name").value;
  const desc = document.getElementById("task-desc").value;
  const date = document.getElementById("deadline").value;

  fetch(API_URL, {
    method: "POST",
    body: new URLSearchParams({
      action: "uploadTask",
      category: category,
      client_name: client,
      task_description: desc,
      deadline: date,
      assigned_by: currentUser || "Anonymous"
    })
  })
    .then(res => res.text())
    .then(txt => {
      if (txt === "task_saved") {
        alert("Task uploaded successfully.");
        loadTasks();
      }
    });
}

function loadTasks() {
  fetch(API_URL, {
    method: "POST",
    body: new URLSearchParams({ action: "getTasks" })
  })
    .then(res => res.text())
    .then(txt => {
      const rows = JSON.parse(txt);
      const container = document.getElementById("task-list");
      container.innerHTML = "";
      rows.slice(1).forEach(task => {
        const div = document.createElement("div");
        div.innerHTML = `<b>${task[0]}</b> - ${task[1]} (${task[2]}) - Due: ${task[3]}`;
        container.appendChild(div);
      });
    });
}
